(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{159:function(e,c,d){"use strict";(function(a){function e(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(c,"__esModule",{value:!0});var n=e(d(10)),r=e(d(3)),l=e(d(6)),o=e(d(4)),u=e(d(5)),t=d(1),i=e(t),s=function(e){function t(){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,l.default)(t,[{key:"componentDidMount",value:function(){this.activePreloder()}},{key:"activePreloder",value:function(){a(".preloader").delay(1200).fadeOut("slow")}},{key:"render",value:function(){return i.default.createElement("div",{className:"preloader"},i.default.createElement("div",{className:"spinner"},i.default.createElement("div",{className:"dot1"}),i.default.createElement("div",{className:"dot2"})))}}]),t}(t.Component);c.default=s}).call(this,d(225))},175:function(){},179:function(){},271:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=a(1),l=(n=r)&&n.__esModule?n:{default:n};t.default=function(e){return l.default.createElement("div",{className:"date"},function(e){var t=Math.floor;if(e){var a=new Date-e;if(a<1e3)return"только что";var n=t(a/1e3);if(n<60)return n+" сек. назад";var r=t(a/6e4);if(r<60)return r+" мин. назад";var l=new Date(e),o=["0"+l.getDate(),"0"+(l.getMonth()+1),""+l.getFullYear(),"0"+l.getHours(),"0"+l.getMinutes()].map(function(e){return e.slice(-2)});return o.slice(0,3).join(".")+" "+o.slice(3).join(":")}}(e.children))}},278:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var l=n(a(1)),r=n(a(696)),o=a(984),u=(0,r.default)(o.Picker);t.default=function(e){var t=e.isOpen,a=e.onSelect,n=e.setRef,r=e.openEmojiBox;return l.default.createElement("div",{className:"emoji-box",ref:n},l.default.createElement("div",{className:"wrap-smile",onClick:r},l.default.createElement("a",{href:"#",className:"smile"})),l.default.createElement(u,{in:t,className:"emoji-picker",color:"#4d73cb",onSelect:a,showSkinTones:!1,skin:1}))}},316:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(a(923));a(924);var l=n(a(1));n(a(7));t.default=function(e){var t=e.deleteRoom,a=e.name,n=e.onClick;e.id;return l.default.createElement("div",{className:"pop-wrapper",onClick:function(e){"BUTTON"!==e.target.tagName&&e.stopPropagation()}},l.default.createElement(r.default,{title:"Удалить канал: "+a+"?",onConfirm:t,okText:"Да",cancelText:"Нет",placement:"right"},l.default.createElement("a",{href:"#",className:"deleteRoom",onClick:n},"Удалить канал")))}},563:function(e,t,a){e.exports=a(564)},564:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var r=n(a(1)),l=n(a(8)),o=a(565);a(977),a(979),a(981),a(262),a(261),a(175),a(179),a(263),l.default.render(r.default.createElement(o.App,null),document.getElementById("root-node"))},565:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.App=void 0;var n,r=a(566),l=(n=r)&&n.__esModule?n:{default:n};t.App=l.default},566:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var l=n(a(2)),o=n(a(1)),u=n(a(159)),i=n(a(567)),s=n(a(620)),c=n(a(887)),r=n(a(946));t.default=(0,r.default)(function(e){var t=e.user.rooms,a=void 0===t?[]:t,n=e.handlerInvite,r=e.location;return r.invite&&(n(r.invite.id),r.invite=null),o.default.createElement(o.default.Fragment,null,o.default.createElement(u.default,null),o.default.createElement("div",{className:"overflow-container"},o.default.createElement(i.default,{roomListIsChange:e.roomListIsChange,changeRoomListProcessed:e.changeRoomListProcessed}),e.isLoaded&&o.default.createElement(c.default,(0,l.default)({rooms:a},e)),o.default.createElement(s.default,e),")}"))})},567:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(a(1)),l=n(a(568)),o=n(a(569));t.default=function(e){return r.default.createElement("header",{className:"chat-header"},r.default.createElement(l.default,null),r.default.createElement(o.default,e))}},568:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=a(1),l=(n=r)&&n.__esModule?n:{default:n};t.default=function(){return l.default.createElement("div",{className:"logo"},l.default.createElement("img",{src:"img/logo.svg",alt:""}),l.default.createElement("h1",null,"Chater"))}},569:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(a(93));a(115);var l=n(a(1)),o=n(a(578));t.default=function(e){return l.default.createElement("div",{className:"flex-container"},l.default.createElement("div",{className:"link-home"},l.default.createElement("a",{href:"/"},"Home")),l.default.createElement(o.default,e),l.default.createElement(r.default,{placement:"bottom",title:"Помощь"},l.default.createElement("div",{className:"question"},l.default.createElement("i",{className:"fas fa-question"}))))}},578:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var l=n(a(69)),o=n(a(22)),u=n(a(68)),i=n(a(23)),s=n(a(21)),c=n(a(10)),d=n(a(3)),f=n(a(6)),m=n(a(4)),p=n(a(5)),v=n(a(592));a(71),a(94),a(610);var r=a(1),h=n(r),g=a(60),E=(a(114),a(270)),_=v.default.Option,y=(v.default.OptGroup,function(e){function r(e){var a=this;(0,d.default)(this,r);var t,n=(0,m.default)(this,(r.__proto__||(0,c.default)(r)).call(this,e));return n.state={inputText:"",dataSource:[]},n.onBlur=function(){n.setState({inputText:""})},n.onSelect=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];console.log("onSelect",t)},n.onChange=function(e){n.setState({inputText:e})},n.renderStatus=function(e){return!e&&h.default.createElement("span",{className:"protected-room"},h.default.createElement(s.default,{type:"lock",theme:"outlined"}))},n.renderOption=function(e){return h.default.createElement(_,{key:e._id,text:e.name,className:"li-search"},e.name,n.renderStatus(e.public))},n.handleSearch=(t=(0,i.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if(n.founds[t]){e.next=6;break}return e.next=5,(0,g.getRooms)(t);case 5:n.founds[t]=e.sent;case 6:console.log(n.founds[t]),n.setState({dataSource:[].concat((0,u.default)(n.founds[t]))});case 8:case"end":return e.stop()}},e,a)})),function(){return t.apply(this,arguments)}),n.founds={},n.handleSearchDebounced=(0,E.debounce)(500,n.handleSearch),n}return(0,p.default)(r,e),(0,f.default)(r,[{key:"componentDidUpdate",value:function(){var e=this.props,t=e.changeRoomListProcessed;e.roomListIsChange&&(this.founds={},t())}},{key:"render",value:function(){var e=this.state,t=e.dataSource,a=e.inputText;return h.default.createElement("div",{className:"search"},h.default.createElement(v.default,{dataSource:t.map(this.renderOption),style:{width:200},onSelect:this.onSelect,onSearch:this.handleSearchDebounced,onChange:this.onChange,placeholder:"Поиск каналов",optionLabelProp:"text",onBlur:this.onBlur,value:a},h.default.createElement(l.default,{className:"find-input",suffix:h.default.createElement(s.default,{type:"search",className:"certain-category-icon"})})))}}]),r}(r.Component));t.default=y},60:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.checkRoomPassword=t.checkInviteLink=t.getInviteLink=t.getRooms=t.deleteRoom=t.getMessages=t.createRoom=t.getUser=void 0;var r,l,o,u,i,s,c,d,f,m=n(a(22)),p=n(a(75)),v=n(a(23)),h=n(a(67)),g=n(a(91)),E=(f=(0,v.default)(m.default.mark(function e(){return m.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new p.default(function(e){return setTimeout(function(){e(2)},2e3)}));case 1:case"end":return e.stop()}},e,void 0)})),function(){return f.apply(this,arguments)});t.getUser=(d=(0,v.default)(m.default.mark(function e(){var t,a;return m.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h.default.get("api/user/profile");case 3:if(t=e.sent,a=t.data,e.t0=!1,e.t0)return e.next=9,E();e.next=9;break;case 9:return e.abrupt("return",a);case 12:throw e.prev=12,e.t1=e.catch(0),new Error("Ошибка загрузки данных...");case 15:case"end":return e.stop()}},e,void 0,[[0,12]])})),function(){return d.apply(this,arguments)}),t.createRoom=(c=(0,v.default)(m.default.mark(function e(t){var a,n,r,l,o,u;return m.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,g.default)("/api/token");case 3:return a=e.sent,t._csrf=a,e.next=7,h.default.post("api/room/create",t);case 7:if(n=e.sent,r=n.data,l=r.status,o=r.message,u=r.info,200!==l)throw new Error(o);e.next=14;break;case 14:return e.abrupt("return",JSON.parse(u));case 17:throw e.prev=17,e.t0=e.catch(0),new Error("Ошибка загрузки данных...");case 20:case"end":return e.stop()}},e,void 0,[[0,17]])})),function(){return c.apply(this,arguments)}),t.getMessages=(s=(0,v.default)(m.default.mark(function e(t,a,n){var r,l,o,u,i,s;return m.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r={start:a,end:n},e.next=4,h.default.get("api/messages/"+t,{params:r});case 4:if(l=e.sent,o=l.data,u=o.status,i=o.message,s=o.info,200!==u)throw new Error(i);e.next=11;break;case 11:return e.abrupt("return",s);case 14:throw e.prev=14,e.t0=e.catch(0),new Error("Ошибка загрузки данных...");case 17:case"end":return e.stop()}},e,void 0,[[0,14]])})),function(){return s.apply(this,arguments)}),t.deleteRoom=(i=(0,v.default)(m.default.mark(function e(t){var a,n,r,l,o,u;return m.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,g.default)("/api/token");case 3:return a=e.sent,e.next=6,h.default.delete("api/room/delete/"+t,{headers:{"X-CSRF-Token":""+a}});case 6:if(n=e.sent,r=n.data,l=r.status,o=r.message,u=r.info,200!==l)throw new Error(o);e.next=13;break;case 13:return e.abrupt("return",u);case 16:throw e.prev=16,e.t0=e.catch(0),new Error("Ошибка отправки запроса...");case 19:case"end":return e.stop()}},e,void 0,[[0,16]])})),function(){return i.apply(this,arguments)}),t.getRooms=(u=(0,v.default)(m.default.mark(function e(){var t,a,n,r,l,o,u=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return m.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={term:u},e.next=4,h.default.get("/api/rooms",{params:t});case 4:if(a=e.sent,n=a.data,r=n.status,l=n.message,o=n.info,200!==r)throw new Error(l);e.next=11;break;case 11:return e.abrupt("return",o);case 14:throw e.prev=14,e.t0=e.catch(0),new Error("Ошибка загрузки данных...");case 17:case"end":return e.stop()}},e,void 0,[[0,14]])})),function(){return u.apply(this,arguments)}),t.getInviteLink=(o=(0,v.default)(m.default.mark(function e(t,a){var n,r,l,o,u,i;return m.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={room_name:a},e.next=4,h.default.get("api/invite/"+t,{params:n});case 4:if(r=e.sent,l=r.data,o=l.status,u=l.message,i=l.info,200!==o)throw new Error(u);e.next=11;break;case 11:return e.abrupt("return",i);case 14:throw e.prev=14,e.t0=e.catch(0),new Error("Ошибка загрузки данных...");case 17:case"end":return e.stop()}},e,void 0,[[0,14]])})),function(){return o.apply(this,arguments)}),t.checkInviteLink=(l=(0,v.default)(m.default.mark(function e(t){var a,n,r,l,o;return m.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h.default.get("/api/check/"+t);case 3:if(a=e.sent,n=a.data,r=n.status,l=n.message,o=n.info,200!==r)throw new Error(l);e.next=10;break;case 10:return e.abrupt("return",o);case 13:throw e.prev=13,e.t0=e.catch(0),new Error("Ошибка загрузки данных...");case 16:case"end":return e.stop()}},e,void 0,[[0,13]])})),function(){return l.apply(this,arguments)}),t.checkRoomPassword=(r=(0,v.default)(m.default.mark(function e(t){var a,n,r,l,o,u;return m.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,g.default)("/api/token");case 3:return a=e.sent,t._csrf=a,e.next=7,h.default.post("/api/room/auth",t);case 7:if(n=e.sent,r=n.data,l=r.status,o=r.message,u=r.info,200!==l)throw new Error(o);e.next=14;break;case 14:return e.abrupt("return",u);case 17:throw e.prev=17,e.t0=e.catch(0),new Error("Неверный пароль.");case 20:case"end":return e.stop()}},e,void 0,[[0,17]])})),function(){return r.apply(this,arguments)})},620:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(a(1)),l=n(a(621)),o=n(a(884));t.default=function(e){return r.default.createElement("div",{className:"main-chat"},r.default.createElement(l.default,e),r.default.createElement(o.default,{users:e.users,queueTypingText:e.queueTypingText}))}},621:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var c=n(a(2)),l=n(a(10)),o=n(a(3)),r=n(a(6)),u=n(a(4)),i=n(a(5)),s=a(1),d=n(s),f=n(a(622)),m=n(a(278)),p=n(a(122)),v=n(a(711)),h=function(e){function t(e){(0,o.default)(this,t);var r=(0,u.default)(this,(t.__proto__||(0,l.default)(t)).call(this,e));return r.state={message:"",emojiIsOpen:!1},r.onCloseEmojiBox=function(e){var t=e.target;r.emojiBoxRef.contains(t)||r.setState({emojiIsOpen:!1})},r.submitForm=function(e){e.preventDefault(),r.props.sendMessage(r.state.message),r.setState({message:""})},r.setTyping=function(){var e=r.props,t=e.setTypingIndicator,a=e.clearTypingIndicator,n=r.defaultInterval;r.timer&&clearTimeout(r.timer),r.isTyping||(t(),r.isTyping=!0),r.timer=setTimeout(function(){r.timer=void 0,r.isTyping=!1,a()},n)},r.onChangeInput=function(e){var t=e.target.value;r.setTyping(),r.setState({message:t})},r.selectEmoji=function(e){var t=e.colons,a=r.state.message;r.setState({message:""+a+t})},r.openEmojiBox=function(e){e.preventDefault(),r.setState({emojiIsOpen:!r.state.emojiIsOpen})},r.setRef=function(e){return r.emojiBoxRef=e},r.timer,r.defaultInterval=3e3,r.isTyping=!1,r.currentRoom,r}return(0,i.default)(t,e),(0,r.default)(t,[{key:"findCurrentRoom",value:function(){var e=this.props.user,t=e.active_room,a=e.rooms,n=void 0===a?[]:a;return this.props.isLoaded?(this.currentRoom=n.find(function(e){return e._id===t}),this.currentRoom):{name:"..."}}},{key:"componentWillUnmount",value:function(){this.timer&&clearTimeout(this.timer)}},{key:"componentWillReceiveProps",value:function(e){var t=e.user.active_room;this.currentRoom&&(t!==this.currentRoom._id&&this.setState({message:""}))}},{key:"render",value:function(){var e=this.props,t=e.isLoaded,a=e.sendMessage,n=this.state,r=n.message,l=n.emojiIsOpen,o=!r.trim().length,u=this.findCurrentRoom(),i=u.name,s=u.unread_messages;return d.default.createElement("div",{className:"chat-container"},t&&d.default.createElement(f.default,(0,c.default)({},this.props,{unReadMessages:s})),d.default.createElement("form",{action:"",className:"send-message",onSubmit:this.submitForm},d.default.createElement("input",{type:"text",name:"message",id:"input-message",placeholder:"Написать в #"+i,autoComplete:"off",value:r,onChange:this.onChangeInput}),d.default.createElement(v.default,{sendMessage:a}),d.default.createElement("div",{className:"btn-wrap"},d.default.createElement("button",{type:"submit",disabled:o,className:"send"})),d.default.createElement(p.default,{touchEvent:"onTouchStart",onClickAway:this.onCloseEmojiBox},d.default.createElement(m.default,{setRef:this.setRef,isOpen:l,onSelect:this.selectEmoji,openEmojiBox:this.openEmojiBox}))))}}]),t}(s.Component);t.default=h},622:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var v=n(a(623)),h=n(a(22)),r=n(a(23)),_=n(a(68)),l=n(a(10)),o=n(a(3)),u=n(a(6)),i=n(a(4)),s=n(a(5)),c=a(1),f=n(c),g=a(983),d=n(a(627)),E=n(a(7)),y=n(a(628)),m=(a(629),n(a(630))),k=a(270),b=n(a(634)),p=n(a(666)),w=a(60),M=(0,p.default)(d.default),x=function(e){function n(e){var m=this;(0,o.default)(this,n);var t,a,p=(0,i.default)(this,(n.__proto__||(0,l.default)(n)).call(this,e));return p.state={list:[],start:-1,end:-1,isEmpty:!1,attempts:0,isLockScroll:!1,initialSize:0,room_id:"",isLoading:!1,unReadMessagesOnScroller:0,unReadMessages:0,isActiveScroller:!1},p.initialState=function(e,t,a){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:function(){};e.length?p.setState({list:[].concat((0,_.default)(e)),unReadMessages:a,initialSize:e.length,room_id:t,start:-p.batchSize-e.length,end:-e.length-1},n):p.setState({isEmpty:!0,room_id:t})},p.checkQueue=function(){p.queueInvites.length&&p.checkInvite(p.queueInvites.shift())},p.uploadInvite=(a=(0,r.default)(h.default.mark(function e(t){var a,n;return h.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=p.props.addInviteToChecked,n=void 0,e.prev=2,e.next=5,(0,w.checkInviteLink)(t);case 5:(n=e.sent).inviteNotValid=!1,a(t,n),p.setState({isLoading:!1},p.checkQueue),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(2),a(t,n={inviteNotValid:!0}),p.setState({isLoading:!1},p.checkQueue);case 16:case"end":return e.stop()}},e,m,[[2,11]])})),function(){return a.apply(this,arguments)}),p.checkInvite=function(e){var t=p.state.isLoading;return p.props.checkedInvitentions[e]?p.checkQueue():t?p.queueInvites.push(e):void p.setState({isLoading:!0},function(){return p.uploadInvite(e)})},p.loadMore=function(){var e=(0,v.default)(p.state.list).slice(1);p.setState({list:e,attempts:0,isLockScroll:!1},function(){var e=p.state,t=e.start,a=e.end;p._loadMoreRows({start:t,end:a})})},p.changeRoom=function(e,t,a){p.initialState(e,t,a)},p.isRowLoaded=function(e){var t=e.index;return!!p.state.list[t]},p.getTemplateRow=function(e){return e.type?"btn"===e.type?f.default.createElement(y.default,{onClick:p.loadMore}):f.default.createElement(b.default,null):f.default.createElement(M,{id:p.props.user._id,message:e,invitations:p.props.checkedInvitentions,checkInvite:p.checkInvite})},p.rowRenderer=function(e){var t=e.key,a=e.index,n=e.style,r=(e.isScrolling,e.isVisible,e.parent),l=p.state,o=l.list,u=l.unReadMessages,i=p.props.user,s=o[a].user_id===i._id,c=a>o.length-1-u,d=(0,E.default)({"w-post":!s,"w-post-my":s,"unread-message":c});return f.default.createElement(g.CellMeasurer,{cache:p.cache,columnIndex:0,key:t,parent:r,rowIndex:a},function(e){var t=e.measure;return f.default.createElement("div",{className:d,onLoad:t,style:n},p.getTemplateRow(o[a],a))})},p.recomputeRowHeights=function(e){p.cache.clearAll(),p.listRef.recomputeRowHeights(),p.scrollToBottom(e)},p.loadingMessages=(t=(0,r.default)(h.default.mark(function e(t,a){var n,r,l,o,u,i,s,c,d,f;return h.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=p.props,r=n.user,l=n.getMessages,o=p.state,u=o.list,i=o.attempts,e.next=4,l(r,t,a);case 4:s=e.sent,c=s.map(JSON.parse),d=(0,v.default)(u),f=d.slice(1),c.length?p.setState({list:[].concat((0,_.default)(c),(0,_.default)(f)),start:t-c.length,end:a-c.length,attempts:i+1,isLockScroll:!1},function(){return p.recomputeRowHeights(c.length-1)}):p.setState({list:[].concat((0,_.default)(c),(0,_.default)(f)),isEmpty:!0,isLockScroll:!1},p.forceUpdate);case 8:case"end":return e.stop()}},e,m)})),function(){return t.apply(this,arguments)}),p._loadMoreRows=function(e){var t=e.start,a=e.end,n=p.state,r=n.list;return n.attempts===p.maxAttempts?void p.setState({list:[{type:"btn"}].concat((0,_.default)(r)),isLockScroll:!0}):void p.setState({list:[{type:"loader"}].concat((0,_.default)(r)),isLockScroll:!0},function(){return p.loadingMessages(t,a)})},p.checkUnreadMessages=function(e){var t=p.state,a=t.list,n=t.unReadMessagesOnScroller;0<n&&e>a.length-1-n&&e<=a.length-1&&p.setState({unReadMessagesOnScroller:n-1})},p.checkScrollerOpening=function(e){var t=p.state.list;if(0!==e){var a=!!(e<t.length-1);p.setState({isActiveScroller:a})}},p._onRowsRendered=function(){return function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];var n=t[0];p.checkScrollerOpeningDebounced(n.stopIndex),p.checkUnreadMessages(n.stopIndex)}},p._onScroll=function(e){var t=e.clientHeight,a=(e.scrollHeight,e.scrollTop),n=p.state,r=n.start,l=n.end,o=n.isEmpty,u=n.isLockScroll;!(0<t)||a||o||u||p._loadMoreRows({start:r,end:l})},p.scrollToBottom=function(e){p.timer=setTimeout(function(){p.listRef.scrollToRow(e),p.listRef.scrollToRow(e)},0)},p._setRef=function(e){p.listRef=e},p.onResize=function(e){e.height,e.width;p.cache.clearAll()},p.onClickScroller=function(){var e=p.state,t=e.unreadMessages,a=e.list;t&&p.setState({unreadMessages:0}),p.scrollToBottom(a.length)},p.cache=new g.CellMeasurerCache({defaultHeight:90,fixedWidth:!0}),p.maxAttempts=2,p.checkScrollerOpeningDebounced=(0,k.debounce)(500,p.checkScrollerOpening),p.onScrollDebounced=(0,k.debounce)(500,p._onScroll),p.onResizeDebounced=(0,k.debounce)(500,p.onResize),p.batchSize=20,p.queueInvites=[],p}return(0,s.default)(n,e),(0,u.default)(n,[{key:"shouldComponentUpdate",value:function(e,t){var a=this.state,n=a.initialSize,r=a.isActiveScroller,l=a.list,o=a.isLoading,u=a.unReadMessagesOnScroller,i=a.unReadMessages;return!!(e.messages.length>n||t.isActiveScroller!==r||t.list.length>l.length||t.isLoading!==o||t.unReadMessagesOnScroller!==u||t.unReadMessages!==i)}},{key:"componentDidMount",value:function(){var e=this,t=this.props,a=t.messages,n=t.user.active_room,r=t.unReadMessages;this.initialState(a,n,r,function(){e.scrollToBottom(e.state.list.length)})}},{key:"componentWillReceiveProps",value:function(e){var t=this,a=e.messages,n=e.user,r=e.unReadMessages,l=n.active_room,o=this.state,u=o.initialSize,i=o.list,s=o.room_id,c=o.start,d=o.end,f=o.unReadMessagesOnScroller;r!==this.state.unReadMessages&&this.setState({unReadMessages:r});var m=function(){t.listRef.forceUpdateGrid(),t.scrollToBottom(i.length)};if(s===l){if(a.length>u){var p=document.querySelector("div.grid"),v=p.scrollHeight,h=p.offsetHeight,g=p.scrollTop,E=a[a.length-1];this.setState({list:[].concat((0,_.default)(i),[E]),isEmpty:!1,initialSize:u+1,start:c-1,end:d-1},function(){Math.round(h+g)===v?m():t.setState({unReadMessagesOnScroller:f+1})})}}else this.changeRoom(a,l,m)}},{key:"componentWillUnmount",value:function(){clearTimeout(this.timer)}},{key:"render",value:function(){var r=this,e=this.state,l=e.list,t=e.isActiveScroller,a=e.unReadMessagesOnScroller;return f.default.createElement(g.InfiniteLoader,{isRowLoaded:this.isRowLoaded,loadMoreRows:function(){},rowCount:l.length},function(e){var n=e.onRowsRendered;e.registerChild;return f.default.createElement("div",{className:"posts"},f.default.createElement(m.default,{unreadMessages:a,isActive:t,onClick:r.onClickScroller}),f.default.createElement(g.AutoSizer,{onResize:r.onResizeDebounced},function(e){var t=e.height,a=e.width;return f.default.createElement(g.List,{className:"grid",onRowsRendered:r._onRowsRendered(n),height:t-50,deferredMeasurementCache:r.cache,rowHeight:r.cache.rowHeight,rowCount:l.length,ref:r._setRef,rowRenderer:r.rowRenderer,width:a,onScroll:r.onScrollDebounced,overscanRowCount:1,scrollToAlignment:"start"})}))})}}]),n}(c.Component);t.default=x},627:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var c=n(a(1)),d=n(a(7)),f=n(a(271));t.default=function(e){var t=e.message,a=e.id,n=e.children,r=t.user_id,l=t.author,o=t.date,u=(t.status,t.avatarPath),i=(0,d.default)({post:!0,"my-post":a===r}),s=(0,d.default)({avatar:a!==r,"my-avatar":a===r});return c.default.createElement("div",{className:i},c.default.createElement("div",{className:s,style:{background:"url("+u+") center center",backgroundSize:"cover"}}),c.default.createElement("div",{className:"message"},c.default.createElement("div",{className:"text"},n),c.default.createElement("div",{className:"footer"},c.default.createElement("div",{className:"author"},l),c.default.createElement(f.default,null,o))))}},628:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=a(1),l=(n=r)&&n.__esModule?n:{default:n};t.default=function(e){var t=e.onClick,a=void 0===t?function(){}:t;return l.default.createElement("div",{className:"load-more",onClick:a},l.default.createElement("span",null,"Загрузить еще?"))}},629:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.MessageLoaderLeft=t.MessageLoaderRight=void 0;var r=n(a(2)),l=n(a(272)),o=n(a(1));t.MessageLoaderRight=function(e){return o.default.createElement(l.default,(0,r.default)({height:100,width:400,speed:2,primaryColor:"#f3f3f3",secondaryColor:"#aebada",className:"loader-right"},e),o.default.createElement("rect",{x:"65.27",y:"34.88",rx:"3",ry:"3",width:"211.58",height:"5"}),o.default.createElement("rect",{x:"45.05",y:"56.11",rx:"3",ry:"3",width:"243.77",height:"5"}),o.default.createElement("rect",{x:"96",y:"76",rx:"3",ry:"3",width:"201",height:"5"}),o.default.createElement("circle",{cx:"331.6",cy:"49.6",r:"33.6"}),o.default.createElement("circle",{cx:"294.5",cy:"41.66",r:"1"}),o.default.createElement("rect",{x:"36.66",y:"14.49",rx:"3",ry:"3",width:"264.69",height:"5"}))},t.MessageLoaderLeft=function(e){return o.default.createElement(l.default,(0,r.default)({height:100,width:400,speed:2,primaryColor:"#f3f3f3",secondaryColor:"#aebada",className:"loader-left"},e),o.default.createElement("rect",{x:"83.27",y:"33.88",rx:"3",ry:"3",width:"211.58",height:"5"}),o.default.createElement("rect",{x:"92.05",y:"54.11",rx:"3",ry:"3",width:"243.77",height:"5"}),o.default.createElement("rect",{x:"72",y:"72",rx:"3",ry:"3",width:"201",height:"5"}),o.default.createElement("circle",{cx:"41.6",cy:"47.6",r:"33.6"}),o.default.createElement("circle",{cx:"294.5",cy:"41.66",r:"1"}),o.default.createElement("rect",{x:"70.66",y:"13.49",rx:"3",ry:"3",width:"264.69",height:"5"}))}},630:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var l=n(a(21)),o=n(a(119));a(94),a(120);var u=n(a(1));t.default=function(e){var t=e.isActive,a=e.onClick,n=void 0===a?function(){}:a,r=e.unreadMessages;return void 0!==t&&t&&u.default.createElement("div",{className:"scroller",onClick:n},0<r&&u.default.createElement(o.default,{className:"scroller-badge",count:r}),u.default.createElement(l.default,{type:"down-circle",theme:"outlined"}))}},634:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(a(1)),l=n(a(183));t.default=function(){return r.default.createElement("div",{className:"loading-bar"},r.default.createElement(l.default,{name:"ball-pulse-sync",className:"loading-spinner",fadeIn:"none"}))}},666:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var u=n(a(53)),c=n(a(119)),d=n(a(10)),f=n(a(3)),r=n(a(6)),m=n(a(4)),l=n(a(5));a(54),a(120);var o=a(1),p=n(o),v=a(667),h=n(a(676)),g=a(30),E=n(a(684)),_=a(114),y=n(a(685));n(a(694)),n(a(183));t.default=function(s){return function(e){function o(){var e,t,i,a;(0,f.default)(this,o);for(var n=arguments.length,r=Array(n),l=0;l<n;l++)r[l]=arguments[l];return(t=i=(0,m.default)(this,(e=o.__proto__||(0,d.default)(o)).call.apply(e,[this].concat(r)))).linkifyYouTubeUrl=function(e){return e.match(/^((?:https?:)?\/\/)?((?:www|m)\.)?((?:youtube\.com|youtu.be))(\/(?:[\w\-]+\?v=|embed\/|v\/)?)([\w\-]+)(\S+)?$/)},i.templateValidInvite=function(){var e=i.props.invitations[i.invite],t=e.room_name,a=e.room_online;return p.default.createElement("div",{className:"invite-link"},p.default.createElement("span",null,"Приглашение в комнату"),p.default.createElement("div",{className:"room-info-wrap"},p.default.createElement("div",{className:"room"},p.default.createElement("img",{src:"/img/room-icon.svg",alt:"room-icon"}),p.default.createElement("div",{className:"room-info"},p.default.createElement("span",null,t),p.default.createElement("span",null,p.default.createElement(c.default,{status:"success"}),a," online"))),p.default.createElement(g.Link,{to:"/chat/"+i.invite},p.default.createElement(u.default,{className:"btn-invite",icon:"check"},"OK"))))},i.templateNotValidInvite=function(){return p.default.createElement("div",{className:"invite-link"},p.default.createElement("span",null,"Приглашение в комнату"),p.default.createElement("div",{className:"room-info-wrap"},p.default.createElement("div",{className:"room"},p.default.createElement("img",{src:"/img/room-icon.svg",alt:"room-icon"}),p.default.createElement("div",{className:"room-info-error"},p.default.createElement("span",{className:"error"},"Оно недействительно"),p.default.createElement("span",null,"Попробуйте отправить новое приглашение")))))},i.templateImage=function(e){return e.length?e.map(function(e){return p.default.createElement("div",{className:"img-wrap",key:(0,_.uniqueId)()},p.default.createElement("img",{src:e[0],alt:"img-message"}))}):null},i.templateVideoPlayer=function(e){return e&&p.default.createElement(y.default,{url:e[0],controls:!0,className:"video-wrap"})},i.renderInvite=function(){var e=i.props.invitations[i.invite].inviteNotValid;return void 0===e||e?i.templateNotValidInvite():i.templateValidInvite()},i.searchInvite=function(e){var t=location.origin+"/chat/",a=new RegExp(t+"[a-zA-Z0-9]{6}"),n=e.match(a);if(n){var r=n[0].split("/"),l=r[r.length-1],o=e.substr(0,n.index),u=e.substr(n.index+n[0].length);return{invite:l,leftOfTheLink:(0,v.emojify)(o),rightOfTheLink:(0,v.emojify)(u)}}},i.searchImg=function(e){for(var t=/(https|http):\/\/[^<>\s]+\/[^<>\s]+\.(png|jpg|svg|gif)\b/gi,a=void 0,n=[];a=t.exec(e);)n.push(a);return n},i.parser=function(){var e=i.props.message.text,t=i.searchInvite(e),a=i.linkifyYouTubeUrl(e),n=i.searchImg(e);if(!t)return p.default.createElement(s,i.props,p.default.createElement(h.default,null,p.default.createElement("div",null,(0,v.emojify)(e),i.templateImage(n),i.templateVideoPlayer(a))));var r=t.invite,l=t.leftOfTheLink,o=t.rightOfTheLink;i.invite=r;var u=i.props.invitations;return p.default.createElement(s,i.props,p.default.createElement(h.default,null,l,u[i.invite]?i.renderInvite():p.default.createElement(E.default,null),o,i.templateImage(n),i.templateVideoPlayer(a)))},a=t,(0,m.default)(i,a)}return(0,l.default)(o,e),(0,r.default)(o,[{key:"componentDidMount",value:function(){var e=this;return this.invite?void setTimeout(function(){e.props.checkInvite(e.invite)},0):void 0}},{key:"render",value:function(){return this.parser()}}]),o}(o.PureComponent)}},684:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(a(2)),l=n(a(272)),o=n(a(1));t.default=function(e){return o.default.createElement("div",{className:"invite-preloader"},o.default.createElement(l.default,(0,r.default)({height:100,width:350,speed:2,primaryColor:"#f3f3f3",secondaryColor:"#aebada"},e),o.default.createElement("rect",{x:"88",y:"42.18",rx:"4",ry:"4",width:"146.25",height:"9"}),o.default.createElement("rect",{x:"88",y:"63.4",rx:"3",ry:"3",width:"114.75",height:"9"}),o.default.createElement("rect",{x:"88",y:"19.66",rx:"3",ry:"3",width:"254.8",height:"9"}),o.default.createElement("circle",{cx:"45.56",cy:"48.56",r:"34.56"})))}},696:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(a(2)),l=n(a(111)),o=n(a(1)),u={transition:"opacity 150ms ease",opacity:0},i={entering:{opacity:0,display:"block"},entered:{opacity:1},exited:{display:"none"}};t.default=function(a){return function(t){return o.default.createElement(l.default,{in:t.in,timeout:150},function(e){return o.default.createElement(a,(0,r.default)({},t,{style:(0,r.default)({},u,i[e])}))})}}},711:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(a(123)),l=n(a(715)),o=n(a(22)),i=n(a(23)),s=n(a(69)),c=n(a(193)),d=n(a(10)),f=n(a(3)),m=n(a(6)),p=n(a(4)),v=n(a(5)),h=n(a(194));a(134),a(872),a(71),a(205),a(206);var u=a(1),g=n(u),E=n(a(91)),_=n(a(278)),y=n(a(122)),k=h.default.Item,b=function(e){function u(){var e,t,l,a;(0,f.default)(this,u);for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];return(t=l=(0,p.default)(this,(e=u.__proto__||(0,d.default)(u)).call.apply(e,[this].concat(r)))).state={token:"",visible:!1,filePath:"",fileName:"",emojiIsOpen:!1},l.onChange=function(e){if("done"===e.file.status){var t=e.file.response.info.filePath;l.setState({fileName:e.file.name,filePath:t,visible:!0}),c.default.success(e.file.name+" file uploaded successfully")}else"error"===e.file.status&&c.default.error(e.file.name+" file upload failed.")},l.showModal=function(){l.setState({visible:!0})},l.handleOk=function(){var n=l.state.filePath,r=l.props.form;r.validateFields(function(e,t){var a=t.messageText;e||(l.props.sendMessage(location.origin+"/"+n+" "+a),r.resetFields(),l.setState({visible:!1}))})},l.handleCancel=function(){l.setState({visible:!1})},l.selectEmoji=function(e){var t=e.colons,a=l.props.form,n=a.getFieldValue;(0,a.setFieldsValue)({messageText:""+n("messageText")+t})},l.openEmojiBox=function(e){e.preventDefault(),l.setState({emojiIsOpen:!l.state.emojiIsOpen})},l.setRef=function(e){return l.emojiBoxRef=e},l.onCloseEmojiBox=function(e){var t=e.target;l.emojiBoxRef.contains(t)||l.setState({emojiIsOpen:!1})},l.getForm=function(){var e=l.props.form.getFieldDecorator,t=l.state.emojiIsOpen;return g.default.createElement(h.default,{layout:"vertical",className:"upload-form-message"},g.default.createElement(k,{label:"Добавить комментарий (необязательно)"},e("messageText")(g.default.createElement(s.default,{type:"text",suffix:g.default.createElement(y.default,{touchEvent:"onTouchStart",onClickAway:l.onCloseEmojiBox},g.default.createElement(_.default,{setRef:l.setRef,isOpen:t,onSelect:l.selectEmoji,openEmojiBox:l.openEmojiBox}))}))))},a=t,(0,p.default)(l,a)}return(0,v.default)(u,e),(0,m.default)(u,[{key:"componentDidMount",value:(t=(0,i.default)(o.default.mark(function e(){var t;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,E.default)("/api/token");case 2:t=e.sent,this.setState({token:t});case 4:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"render",value:function(){var e=this.state,t=e.token,a=e.filePath,n=e.fileName;return g.default.createElement("div",{className:"wrap-link"},g.default.createElement(l.default,{onChange:this.onChange,name:"message_img",showUploadList:!1,action:"/api/upload/img",headers:{"X-CSRF-Token":""+t}},g.default.createElement("a",{href:"#",className:"link"})),g.default.createElement(r.default,{title:"Отправка сообщения",visible:this.state.visible,onOk:this.handleOk,onCancel:this.handleCancel,okText:"Загрузить",cancelText:"Отмена"},g.default.createElement("div",{className:"wrap-message-img"},g.default.createElement("img",{src:a,className:"message-image",alt:"message-image"}),g.default.createElement("span",null,n)),this.getForm()))}}]),u;var t}(u.Component);t.default=h.default.create()(b)},884:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(a(2)),r=n(a(10)),l=n(a(3)),o=n(a(6)),u=n(a(4)),s=n(a(5)),c=a(1),d=n(c),f=n(a(885)),m=n(a(886)),p=function(e){function t(e){(0,l.default)(this,t);var n=(0,u.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));return n.state={isOpen:!1,user:"",target:null},n.handlerCloseProfile=function(e){var t=e.target;!n.miniProfile||n.listUsers.current.contains(t)||n.miniProfile.contains(t)||n.setState({isOpen:!1})},n.handlerOpenProfile=function(a){return function(e){e.preventDefault();var t=n.props.users.find(function(e){return e._id===a});t&&n.setState({isOpen:!0,user:(0,i.default)({},t),target:e.currentTarget})}},n.setRef=function(e){return n.miniProfile=e},n.listUsers=d.default.createRef(),n}return(0,s.default)(t,e),(0,o.default)(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.users,a=this.state,n=a.user;a.isOpen&&(t.find(function(e){return e._id===n._id})||this.setState({isOpen:!1,user:"",target:null}))}},{key:"render",value:function(){var e=this,t=this.props,a=t.users,n=t.queueTypingText,r=this.state,l=r.isOpen,o=r.user,u=r.target;return d.default.createElement(c.Fragment,null,o&&d.default.createElement(m.default,{setRef:this.setRef,isOpen:l,user:o,target:u,handleClose:this.handlerCloseProfile}),d.default.createElement("div",{className:"right-side-bar"},d.default.createElement("h3",null,"В сети -",d.default.createElement("span",{className:"online-count"}," ",a.length," ")),d.default.createElement("ul",{className:"userOnline",ref:this.listUsers},a.map(function(t){return d.default.createElement(f.default,(0,i.default)({key:t._id,handlerOpenProfile:e.handlerOpenProfile(t._id)},t,{isTyping:n.some(function(e){return e._id===t._id})}))}))))}}]),t}(c.Component);t.default=p},885:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(a(1)),u=n(a(7)),i=n(a(183));t.default=function(e){var t=(0,u.default)({animated:!0,bounceInRight:!0}),a=e.username,n=e.profile.avatarPath,r=e.handlerOpenProfile,l=e.isTyping;return o.default.createElement("li",{className:t,onClick:r},o.default.createElement("div",{className:"wrap-rb-online"},o.default.createElement("img",{src:n,alt:"avatar"}),l&&o.default.createElement(i.default,{name:"ball-beat",color:"steelblue",overrideSpinnerClassName:"spinner-typing"})),o.default.createElement("span",{className:"name"},a))}},886:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var d=n(a(2)),i=n(a(119)),s=n(a(10)),c=n(a(3)),r=n(a(6)),f=n(a(4)),l=n(a(5));a(120);var o=a(1),m=n(o),p=n(a(233)),u=n(a(238)),v=n(a(248)),h=a(112),g=n(a(7)),E=n(a(122)),_=n(a(271)),y=(0,h.withStyles)({root:{backgroundColor:"#5277CA",boxShadow:"0 0 30px rgba(0,0,0, .3)",borderRadius:0}})(u.default),k=function(e){function u(){var e,t,l,a;(0,c.default)(this,u);for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];return(t=l=(0,f.default)(this,(e=u.__proto__||(0,s.default)(u)).call.apply(e,[this].concat(r)))).onlineStatusTemplate=function(){var e=l.props.user,t=e.offline_date,a=e.online_date,n=new Date(t).getTime(),r=n<new Date(a).getTime();return m.default.createElement("div",{className:"wrap-online-date"},r?m.default.createElement(i.default,{status:"success"}):m.default.createElement("span",null,"Был в сети "),r?m.default.createElement("span",null," В сети"):m.default.createElement(_.default,null,n))},a=t,(0,f.default)(l,a)}return(0,l.default)(u,e),(0,r.default)(u,[{key:"render",value:function(){var a=this,e=this.props,t=e.isOpen,n=e.target,r=e.user,l=r.username,o=r.profile,u=e.classes,i=e.setRef,s=e.handleClose,c=(0,g.default)(u.root);return m.default.createElement(p.default,{ref:i,open:t,anchorEl:n,className:c,placement:"left-start",transition:!0,modifiers:{flip:{behavior:["right","left"]}}},function(e){var t=e.TransitionProps;return m.default.createElement(E.default,{touchEvent:"onTouchStart",onClickAway:s},m.default.createElement("div",{ref:i},m.default.createElement(v.default,(0,d.default)({},t,{timeout:250}),m.default.createElement(y,{className:"tooltipster-profile-customized",square:!1},m.default.createElement("div",{className:"tooltipster-content"},m.default.createElement("div",{className:"header"},m.default.createElement("img",{src:o.avatarPath,alt:"avatar"}),m.default.createElement("strong",null,l),a.onlineStatusTemplate()),m.default.createElement("div",{className:"content"},m.default.createElement("ul",null,m.default.createElement("li",null,m.default.createElement("a",{href:"#"},"Настройки")),m.default.createElement("li",null,m.default.createElement("a",{href:"#"},"Друзья")),m.default.createElement("li",null,m.default.createElement("a",{href:"#"},"Личные сообщения")))))))))})}}]),u}(o.Component);t.default=(0,h.withStyles)({root:{zIndex:100,display:"flex"}})(k)},887:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(a(10)),l=n(a(3)),o=n(a(6)),u=n(a(4)),i=n(a(5)),s=a(1),c=n(s),d=n(a(888)),f=n(a(889)),m=n(a(908)),p=n(a(7)),v=n(a(122)),h=function(e){function t(e){(0,l.default)(this,t);var n=(0,u.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));return n.state={isOpen:!1},n.getModalWindow=function(){return document.querySelector("div.ant-modal")||{contains:function(){}}},n.getPopover=function(){return document.querySelectorAll("div.ant-popover")||[]},n.getDomElements=function(e){return document.querySelectorAll(e)||[]},n.handleCloseMenu=function(e){var t=e.target,a=function(e){return e.contains(t)};n.leftBar.current.contains(t)||[].some.call(n.getDomElements("div.ant-popover"),a)||[].some.call(n.getDomElements("div.ant-modal"),a)||n.setState({isOpen:!1})},n.toggleMenu=function(){n.setState({isOpen:!n.state.isOpen})},n.leftBar=c.default.createRef(),n}return(0,i.default)(t,e),(0,o.default)(t,[{key:"render",value:function(){var e=this.state.isOpen,t=this.props,a=t.rooms,n=t.createRoom,r=t.deleteRoom,l=t.changeRoom,o=t.user,u=(0,p.default)({"left-side-bar":!0,active:e}),i=(0,p.default)({toggle:!0,hide:e});return c.default.createElement(v.default,{touchEvent:"onTouchStart",onClickAway:this.handleCloseMenu},c.default.createElement("div",{className:u,ref:this.leftBar},c.default.createElement("span",{className:i,onClick:this.toggleMenu}),c.default.createElement("div",{className:"collapsed-bar",id:"left-bar"},c.default.createElement("div",{className:"closes",onClick:this.toggleMenu}),c.default.createElement(f.default,{user:o,closeNav:this.toggleMenu}),c.default.createElement(m.default,{rooms:a,active_room:o.active_room,createRoom:n,deleteRoom:r,changeRoom:l})),c.default.createElement(d.default,null)))}}]),t}(s.Component);t.default=h},888:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=a(1),l=(n=r)&&n.__esModule?n:{default:n};t.default=function(){return l.default.createElement("div",{className:"bar-footer"},l.default.createElement("div",{className:"sign-out"},l.default.createElement("i",{className:"fas fa-power-off"}),l.default.createElement("a",{href:""},"Sign out")))}},889:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(a(10)),s=n(a(3)),r=n(a(6)),c=n(a(4)),l=n(a(5)),o=a(1),d=n(o),f=n(a(890)),u=function(e){function u(){var e,t,a,n;(0,s.default)(this,u);for(var r=arguments.length,l=Array(r),o=0;o<r;o++)l[o]=arguments[o];return(t=a=(0,c.default)(this,(e=u.__proto__||(0,i.default)(u)).call.apply(e,[this].concat(l)))).state={visible:!1},a.showProfile=function(){a.props.closeNav(),a.setState({visible:!0})},a.onCloseProfile=function(){a.setState({visible:!1})},a.changeAvatar=function(){},a.renderNav=function(){return d.default.createElement("nav",null,d.default.createElement("ul",null,d.default.createElement("li",null,d.default.createElement("a",{href:"#",onClick:a.showProfile},"Profile")),d.default.createElement("li",null,d.default.createElement("a",{href:"#"},"Messages")),d.default.createElement("li",null,d.default.createElement("a",{href:"#"},"Settings"))))},n=t,(0,c.default)(a,n)}return(0,l.default)(u,e),(0,r.default)(u,[{key:"render",value:function(){var e=this.state.visible,t=this.props.user;return d.default.createElement(o.Fragment,null,d.default.createElement(f.default,{user:t,visible:e,onClose:this.onCloseProfile,changeAvatar:this.changeAvatar}),this.renderNav())}}]),u}(o.Component);t.default=u},890:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var c=n(a(891)),d=n(a(897)),f=n(a(311)),m=n(a(313)),p=n(a(53)),v=n(a(898)),h=n(a(2));a(899),a(902),a(314),a(315),a(54),a(905);var g=n(a(1)),E={fontSize:16,color:"rgba(0,0,0,0.85)",lineHeight:"24px",display:"block",marginBottom:16},_=function(e){var t=e.title,a=e.content;return g.default.createElement("div",{className:"description-item",style:{fontSize:14,lineHeight:"22px",marginBottom:7,color:"rgba(0,0,0,0.65)"}},g.default.createElement("p",{style:{marginRight:8,display:"inline-block",color:"rgba(0,0,0,0.85)"}},t,":"),a)};t.default=function(e){var t=e.visible,a=e.onClose,n=e.changeAvatar,r=e.user,l=r.username,o=r.email,u=r.profile,i=u.avatarPath,s=u.status;return g.default.createElement("div",null,g.default.createElement(c.default,{width:"100%",placement:"left",closable:!0,onClose:a,visible:t},g.default.createElement("p",{style:(0,h.default)({},E,{marginBottom:24})},"User Profile"),g.default.createElement("div",{className:"profile-avatar-box"},g.default.createElement(v.default,{shape:"circle",size:86,icon:"user",src:i,style:{backgroundColor:"#ffbf00",verticalAlign:"middle"}},l),g.default.createElement(p.default,{size:"small",style:{marginLeft:16,verticalAlign:"middle"},onClick:n},"Change")),g.default.createElement("p",{style:E},"Personal"),g.default.createElement(f.default,null,g.default.createElement(m.default,{span:12},g.default.createElement(_,{title:"Full Name",content:l})),g.default.createElement(m.default,{span:12},g.default.createElement(_,{title:"Account",content:o}))),g.default.createElement(f.default,null,g.default.createElement(m.default,{span:12},g.default.createElement(_,{title:"City",content:"Москва"})),g.default.createElement(m.default,{span:12},g.default.createElement(_,{title:"Country",content:"Россия"}))),g.default.createElement(f.default,null,g.default.createElement(m.default,{span:12},g.default.createElement(_,{title:"Birthday",content:"February 2,1900"})),g.default.createElement(m.default,{span:12},g.default.createElement(_,{title:"Website",content:"-"}))),g.default.createElement(f.default,null,g.default.createElement(m.default,{span:24},g.default.createElement(_,{title:"Status",content:s}))),g.default.createElement(d.default,null),g.default.createElement("p",{style:E},"Company"),g.default.createElement(f.default,null,g.default.createElement(m.default,{span:12},g.default.createElement(_,{title:"Position",content:"Programmer"})),g.default.createElement(m.default,{span:12},g.default.createElement(_,{title:"Responsibilities",content:"Coding"}))),g.default.createElement(f.default,null,g.default.createElement(m.default,{span:12},g.default.createElement(_,{title:"Department",content:"AFX"})),g.default.createElement(m.default,{span:12},g.default.createElement(_,{title:"Supervisor",content:g.default.createElement("a",null,"Lin")}))),g.default.createElement(f.default,null,g.default.createElement(m.default,{span:24},g.default.createElement(_,{title:"Skills",content:"C / C + +, data structures, software engineering, operating systems, computer networks, databases, compiler theory, computer architecture, Microcomputer Principle and Interface Technology, Computer English, Java, ASP, etc."}))),g.default.createElement(d.default,null),g.default.createElement("p",{style:E},"Contacts"),g.default.createElement(f.default,null,g.default.createElement(m.default,{span:12},g.default.createElement(_,{title:"Email",content:o})),g.default.createElement(m.default,{span:12},g.default.createElement(_,{title:"Phone Number",content:"+86 181 0000 0000"}))),g.default.createElement(f.default,null,g.default.createElement(m.default,{span:24},g.default.createElement(_,{title:"Github",content:g.default.createElement("a",{href:"http://github.com/ant-design/ant-design/"},"github.com/ant-design/ant-design/")})))))}},908:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var u=n(a(93)),i=n(a(119)),d=n(a(193)),f=n(a(22)),m=n(a(9)),p=n(a(2)),v=n(a(23)),h=n(a(10)),g=n(a(3)),r=n(a(6)),E=n(a(4)),l=n(a(5));a(115),a(120),a(205);var o=a(1),_=n(o),s=n(a(909)),y=(n(a(316)),n(a(928))),c=n(a(941)),k=a(60),b=n(a(7)),w=location.origin+"/chat",M={placement:"top",mouseEnterDelay:0,mouseLeaveDelay:0},x=function(e){function o(){var e,t,s,a,c=this;(0,g.default)(this,o);for(var n=arguments.length,r=Array(n),l=0;l<n;l++)r[l]=arguments[l];return(t=s=(0,E.default)(this,(e=o.__proto__||(0,h.default)(o)).call.apply(e,[this].concat(r)))).state={visibleModalForm:!1,visibleInvitingModal:!1,inviteLink:"",confirmLoading:!1,invitations:{}},s.showInvitingModal=function(u,i){return(0,v.default)(f.default.mark(function e(){var t,a,n,r,l,o;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t=s.state.invitations,s.currentRoomName=u,s.currentRoomId=i,!t[i]){e.next=10;break}if(a=t[i].invitationExpires,new Date(a).getTime()>Date.now())return s.setState({visibleInvitingModal:!0}),e.abrupt("return");e.next=10;break;case 10:return e.next=12,(0,k.getInviteLink)(i,u);case 12:n=e.sent,r=n.invitation_id,l=n.room_name,o=n.invitationExpires,s.setState({visibleInvitingModal:!0,invitations:(0,p.default)({},t,(0,m.default)({},i,{invitation_id:r,room_name:l,invitationExpires:o,inviteLink:w+"/"+r}))}),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(0),console.log(e.t0);case 22:case"end":return e.stop()}},e,c,[[0,19]])}))},s.handleOkInvitingModal=function(){s.setState({visibleInvitingModal:!1})},s.handleCancelInvitingModal=function(){s.setState({visibleInvitingModal:!1})},s.showModalWithForm=function(){s.setState({visibleModalForm:!0})},s.handleCreate=function(){var e,n=s.formRef.props.form;n.validateFields((e=(0,v.default)(f.default.mark(function e(t,a){return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t)return e.abrupt("return");e.next=2;break;case 2:return s.setState({confirmLoading:!0}),e.prev=3,e.next=6,s.props.createRoom(a);case 6:n.resetFields(),s.setState({visibleModalForm:!1,confirmLoading:!1}),d.default.success("Комната "+a.roomName+" успешно создана."),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(3),d.default.error(e.t0.message);case 14:case"end":return e.stop()}},e,c,[[3,11]])})),function(){return e.apply(this,arguments)}))},s.saveFormRef=function(e){s.formRef=e},s.handleCancel=function(){s.setState({visibleModalForm:!1})},s.deleteRoom=function(t,a){return e=(0,v.default)(f.default.mark(function e(){return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.props.deleteRoom(t);case 3:d.default.success("Комната "+a+" успешно удалена."),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),d.default.error(e.t0.message);case 9:case"end":return e.stop()}},e,c,[[0,6]])})),function(){return e.apply(this,arguments)};var e},s.changeRoom=function(t){return function(e){e.preventDefault(),s.props.changeRoom(t)}},s.renderListRooms=function(){var e=s.props,t=e.rooms,r=e.active_room;return _.default.createElement("ul",{className:"list-rooms"},t.map(function(e){var t=e._id,a=e.name,n=e.unread_messages;return _.default.createElement("li",{key:t},_.default.createElement("div",{className:"not-read"},_.default.createElement(i.default,{count:n,overflowCount:9,className:"message-counter"})),_.default.createElement(u.default,(0,p.default)({},M,{title:"Перейти в комнату?"}),_.default.createElement("a",{className:(0,b.default)({"active-room":r===t}),href:"#",onClick:s.changeRoom(t),onTouchStart:s.changeRoom(t)},a)),_.default.createElement(y.default,{_id:t,name:a,deleteRoom:s.deleteRoom(t,a),showInvitingModal:s.showInvitingModal(a,t)}))}))},a=t,(0,E.default)(s,a)}return(0,l.default)(o,e),(0,r.default)(o,[{key:"render",value:function(){var e=this.state,t=e.visibleModalForm,a=e.confirmLoading,n=e.visibleInvitingModal,r=e.invitations;return _.default.createElement("div",{className:"rooms"},_.default.createElement(s.default,{visible:t,confirmLoading:a,onCancel:this.handleCancel,onCreate:this.handleCreate,wrappedComponentRef:this.saveFormRef}),_.default.createElement("h3",null,"Rooms",_.default.createElement(u.default,(0,p.default)({},M,{title:"Создать новую комнату?"}),_.default.createElement("span",{className:"rooms-add",onClick:this.showModalWithForm,onTouchStart:this.showModalWithForm},_.default.createElement("i",{className:"fas fa-plus"})))),r[this.currentRoomId]&&_.default.createElement(c.default,{invitation:r[this.currentRoomId],showInvitingModal:this.showInvitingModal,handleOkInvitingModal:this.handleOkInvitingModal,handleCancelInvitingModal:this.handleCancelInvitingModal,visible:n}),this.renderListRooms())}}]),o}(o.Component);t.default=x},909:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(a(123)),s=n(a(311)),c=n(a(21)),d=n(a(313)),f=n(a(910)),m=n(a(69)),p=n(a(10)),v=n(a(3)),r=n(a(6)),h=n(a(4)),l=n(a(5)),g=n(a(194));a(134),a(314),a(94),a(315),a(918),a(71),a(206);var E=n(a(1)),_=n(a(921)),y=g.default.Item,o=g.default.create()(function(e){function u(){var e,t,a,n;(0,v.default)(this,u);for(var r=arguments.length,l=Array(r),o=0;o<r;o++)l[o]=arguments[o];return(t=a=(0,h.default)(this,(e=u.__proto__||(0,p.default)(u)).call.apply(e,[this].concat(l)))).state={privateRoom:!1},a.onChangeRadio=function(e){"public"===e.target.value?a.setState({privateRoom:!1}):a.setState({privateRoom:!0})},n=t,(0,h.default)(a,n)}return(0,l.default)(u,e),(0,r.default)(u,[{key:"render",value:function(){var e=this.props,t=e.visible,a=e.onCancel,n=e.onCreate,r=e.form,l=e.confirmLoading,o=r.getFieldDecorator,u=this.state.privateRoom;return E.default.createElement(i.default,{visible:t,title:"Создать новую комнату",okText:"Создать",cancelText:"Отмена",confirmLoading:l,onCancel:a,onOk:n},E.default.createElement(g.default,{layout:"vertical"},E.default.createElement(y,{label:"Название"},o("roomName",{rules:[{required:!0,message:"Введите название комнаты."}]})(E.default.createElement(m.default,null))),E.default.createElement(y,{className:"collection-create-form_last-form-item"},E.default.createElement(s.default,{gutter:8,style:{display:"flex",alignItems:"center",height:"40px"}},E.default.createElement(d.default,{span:12},o("modifier",{initialValue:"public"})(E.default.createElement(f.default.Group,{onChange:this.onChangeRadio},E.default.createElement(f.default,{value:"public"},"Окрытая"),E.default.createElement(f.default,{value:"private"},"Приватная")))),E.default.createElement(_.default,{in:u},E.default.createElement(d.default,{span:12},u&&o("passwordRoom",{rules:[{required:!0,message:"Введите пароль для комнаты."}]})(E.default.createElement(m.default,{prefix:E.default.createElement(c.default,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"Пароль для комнаты"}))))))))}}]),u}(E.default.Component));t.default=o},91:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r,l=n(a(22)),o=n(a(23)),u=n(a(67)),i=(r=(0,o.default)(l.default.mark(function e(t){var a,n;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.default.get(t);case 2:return a=e.sent,n=a.data.token,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,void 0)})),function(){return r.apply(this,arguments)});t.default=i},928:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var l=n(a(929)),o=n(a(21)),u=n(a(931));a(935),a(94),a(938);var i=n(a(1)),s=n(a(316)),c=u.default.Item,d=u.default.Divider;t.default=function(e){var t=e.deleteRoom,a=e.name,n=e.showInvitingModal,r=i.default.createElement(u.default,null,i.default.createElement(c,{key:"0"},i.default.createElement("a",{href:"#",onClick:n},"Создать приглашение")),i.default.createElement(c,{key:"1"},i.default.createElement("a",{href:"#"},"Настройки")),i.default.createElement(c,{key:"2"},i.default.createElement("a",{href:"#"},"Обзор")),i.default.createElement(d,null),i.default.createElement(c,{key:"3"},i.default.createElement(s.default,{name:a,deleteRoom:t,onClick:function(e){e.stopPropagation()}})));return i.default.createElement("div",{className:"room-menu"},i.default.createElement(l.default,{placement:"topRight",overlay:r,trigger:["click"],getPopupContainer:function(){return document.querySelector("div.room-menu")}},i.default.createElement("span",{className:"btn-room-menu"},i.default.createElement(o.default,{type:"setting",theme:"outlined",className:"setting-room"}))))}},941:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var c=n(a(123)),d=n(a(53)),f=n(a(69)),i=n(a(10)),s=n(a(3)),r=n(a(6)),m=n(a(4)),l=n(a(5));a(134),a(54),a(71);var o=a(1),p=n(o),v=a(942),u=function(e){function u(){var e,t,a,n;(0,s.default)(this,u);for(var r=arguments.length,l=Array(r),o=0;o<r;o++)l[o]=arguments[o];return(t=a=(0,m.default)(this,(e=u.__proto__||(0,i.default)(u)).call.apply(e,[this].concat(l)))).state={copied:!1},a.onCopyTimeout=function(){setTimeout(function(){a.setState({copied:!1})},2e3)},a.onCopy=function(){a.setState({copied:!0},a.onCopyTimeout)},n=t,(0,m.default)(a,n)}return(0,l.default)(u,e),(0,r.default)(u,[{key:"render",value:function(){var e=this.props,t=e.visible,a=e.handleOkInvitingModal,n=e.handleCancelInvitingModal,r=e.invitation,l=r.room_name,o=r.inviteLink,u=this.state.copied,i={backgroundColor:u?"#43a731":"#5478cb",transition:".5s ease",width:"160px",fontSize:"14px"},s={borderColor:u?"#43a731":"#d9d9d9"};return p.default.createElement("div",null,p.default.createElement(c.default,{title:"Пригласить друзей в канал: "+l,visible:t,cancelText:"Отмена",onOk:a,onCancel:n},p.default.createElement("div",{className:"invitation-wrapper"},p.default.createElement("p",null,"Поделитесь этой ссылкой с другими, чтобы предоставить им доступ к этой комнате."),p.default.createElement("div",{className:"input-group-copy"},p.default.createElement(f.default,{size:"large",onChange:function(){},style:s,value:o}),p.default.createElement(v.CopyToClipboard,{text:o,onCopy:this.onCopy},p.default.createElement(d.default,{type:"primary",size:"large",style:i},u?"Скопировано":"Копировать"))),p.default.createElement("p",{className:"info-invite"},"Данная ссылка-приглашение истечет через 1 день."))))}}]),u}(o.Component);t.default=u},946:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(a(193)),i=n(a(9)),s=n(a(22)),c=n(a(23)),d=n(a(68)),m=n(a(2)),p=n(a(947)),v=n(a(10)),h=n(a(3)),u=n(a(6)),g=n(a(4)),f=n(a(5));a(205),a(948);var E=a(1),_=n(E),y=n(a(951)),k=a(60),b=a(30),w=n(a(976));t.default=function(r){return function(e){function l(e){var u=this;(0,h.default)(this,l);var t,a,n,r,f=(0,g.default)(this,(l.__proto__||(0,v.default)(l)).call(this,e));return f.state={users:[],user:{},messages:[],isLoading:!1,isLoaded:!1,errors:[],roomListIsChange:!1,checkedInvitentions:{},visibleModal:!1,confirmLoadingModal:!1,queueTypingText:[]},f.checkQueue=function(){f.queueOperations.length&&f.queueOperations.shift()()},f.getDescriptionNotification=function(){var e,t=f.state.user,a=t.rooms,n=t.active_room,r=a.find(function(e){return e._id===n}),l=r.name,o=r.unread_messages,u=void 0===o?0:o,i=r.leave_date,s=void 0===i?"":i,c=f.state.users.length,d=["2","3","4"];return{message:"Вы зашли в канал: "+l+".",description:_.default.createElement("div",{className:"notify-desc"},_.default.createElement("p",null,"В данном канале ",c," ",(e=c,d.includes(e.toString().slice(-1))?"человека.":"человек.")),_.default.createElement("p",null,s?"Дата последнего посещения: "+new Date(s).toLocaleString()+".":""),_.default.createElement("p",null,u?"Количество непрочитанных сообщений: "+u+".":""))}},f.openNotification=function(){return p.default.open(f.getDescriptionNotification())},f.markAsRead=function(){var e=f.state.user,t=e.rooms,a=e.active_room,n=t.map(function(e){return e._id===a&&(e.unread_messages=0),e});f.setState({user:(0,m.default)({},f.state.user,{rooms:n})})},f.socketEvents=function(){f.socket.on("connection_success",function(e){var t=e.users,a=e.user;f.setState({users:t,user:a,isLoading:!0,isLoaded:!1},function(){f.openNotification(),setTimeout(f.markAsRead,f.unreadMessageTime)}),f.getMessages(a).then(function(e){return e.map(JSON.parse)}).then(function(e){f.setState({isLoading:!1,isLoaded:!0,messages:e},f.checkQueue)})}),f.socket.on("user_connected",function(e){var t=e.users;e.room_id===f.state.user.active_room&&f.setState({users:t})}),f.socket.on("user_disconnect",function(e){var t=e.users;e.room_id===f.state.user.active_room&&f.setState({users:t})}),f.socket.on("rooms_messages_latest",function(e){var a=JSON.parse(e),t=f.state.user.active_room;if(a.room_id===t)f.setState({messages:[].concat((0,d.default)(f.state.messages),[a])});else{var n=f.state.user.rooms.reduce(function(e,t){return t._id===a.room_id?[].concat((0,d.default)(e),[(0,m.default)({},t,{unread_messages:++t.unread_messages||1})]):[].concat((0,d.default)(e),[t])},[]);f.setState({user:(0,m.default)({},f.state.user,{rooms:n})})}}),f.socket.on("typing",function(e){return f.setState({queueTypingText:e})})},f.sendMessage=function(e){f.clearTypingIndicator(),f.socket.emit("new_message",e)},f.getMessages=(r=(0,c.default)(s.default.mark(function e(t){var a,n,r=t.active_room,l=1<arguments.length&&void 0!==arguments[1]?arguments[1]:-20,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:-1;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,k.getMessages)(r,l,o);case 3:return e.abrupt("return",e.sent);case 6:e.prev=6,e.t0=e.catch(0),a=e.t0.message,n=a instanceof Array?a:[a],f.setState({isLoading:!1,isLoaded:!0,errors:n});case 11:case"end":return e.stop()}},e,u,[[0,6]])})),function(){return r.apply(this,arguments)}),f.createRoom=(n=(0,c.default)(s.default.mark(function e(t){var a,n,r=t.roomName,l=t.modifier,o=t.passwordRoom;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(a={room_author:f.state.user._id,name:r,public:"public"===l}).public||(a.password=o),e.next=5,(0,k.createRoom)(a);case 5:n=e.sent,f.socket.emit("update_rooms_list",n),f.setState({roomListIsChange:!0,user:(0,m.default)({},f.state.user,{rooms:[].concat((0,d.default)(f.state.user.rooms),[(0,m.default)({},n)])})}),e.next=14;break;case 10:throw e.prev=10,e.t0=e.catch(0),console.log(e.t0),new Error("Произошла ошибка, повторите запрос.");case 14:case"end":return e.stop()}},e,u,[[0,10]])})),function(){return n.apply(this,arguments)}),f.deleteRoom=(a=(0,c.default)(s.default.mark(function e(t){var a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=f.state.user.rooms,e.next=4,(0,k.deleteRoom)(t);case 4:f.setState({roomListIsChange:!0}),f.socket.emit("delete_room",{id:t,rooms:a}),e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(0),new Error("Произошла ошибка, повторите запрос.");case 11:case"end":return e.stop()}},e,u,[[0,8]])})),function(){return a.apply(this,arguments)}),f.changeRoomListProcessed=function(){f.setState({roomListIsChange:!1})},f.changeRoom=function(e){var t=f.state.user,a=t.active_room,n=t.rooms;f.state.queueTypingText.length&&f.clearTypingIndicator(),e!==a&&f.socket.emit("change_room",{id:e,rooms:n})},f.setTypingIndicator=function(){return f.socket.emit("user_typing_start")},f.clearTypingIndicator=function(){return f.socket.emit("user_typing_end")},f.addInviteToChecked=function(e,t){var a=f.state.checkedInvitentions;f.setState({checkedInvitentions:(0,m.default)({},a,(0,i.default)({},e,(0,m.default)({},t)))})},f.showModal=function(){setTimeout(function(){f.setState({visibleModal:!0})},2e3)},f.handleCancel=function(){f.setState({visibleModal:!1})},f.handleCreate=function(){var e,n=f.formRef.props.form;n.validateFields((e=(0,c.default)(s.default.mark(function e(t,a){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t)return e.abrupt("return");e.next=2;break;case 2:return f.setState({confirmLoadingModal:!0}),e.prev=3,e.next=6,(0,k.checkRoomPassword)((0,m.default)({},a,{room_id:f.invite.room_id}));case 6:n.resetFields(),f.setState({visibleModal:!1,confirmLoadingModal:!1}),f.socket.emit("call_invitation",f.invite.invitation_id),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(3),o.default.error(e.t0.message),f.setState({confirmLoadingModal:!1});case 15:case"end":return e.stop()}},e,u,[[3,11]])})),function(){return e.apply(this,arguments)}))},f.saveFormRef=function(e){f.formRef=e},f.handlerInvite=(t=(0,c.default)(s.default.mark(function e(t){var a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(f.state.isLoaded){e.next=3;break}return f.queueOperations.push(function(){return f.handlerInvite(t)}),e.abrupt("return");case 3:if(a=f.state.checkedInvitentions,e.prev=4,!a[t]){e.next=9;break}f.invite=a[t],e.next=13;break;case 9:return e.next=11,(0,k.checkInviteLink)(t);case 11:f.invite=e.sent,f.addInviteToChecked(t,f.invite);case 13:if(f.state.user.rooms.find(function(e){return e._id===f.invite.room_id}))return e.abrupt("return",o.default.warning("Канал "+f.invite.room_name+" уже добавлен."));e.next=16;break;case 16:if(f.invite.room_public){e.next=18;break}return e.abrupt("return",f.showModal());case 18:return e.abrupt("return",f.socket.emit("call_invitation",f.invite.invitation_id));case 21:e.prev=21,e.t0=e.catch(4),console.log(e.t0),o.default.error("Данное приглашение недействительно.");case 25:case"end":return e.stop()}},e,u,[[4,21]])})),function(){return t.apply(this,arguments)}),f.socket=(0,y.default)(),f.queueOperations=[],f.invite={},f.unreadMessageTime=5e3,f}return(0,f.default)(l,e),(0,u.default)(l,[{key:"componentDidMount",value:function(){this.socketEvents()}},{key:"render",value:function(){var a=this,e=this.state,t=e.visibleModal,n=e.confirmLoadingModal;return _.default.createElement(b.BrowserRouter,null,_.default.createElement(E.Fragment,null,_.default.createElement(w.default,{wrappedComponentRef:this.saveFormRef,invite:this.invite,visible:t,confirmLoading:n,handleCancel:this.handleCancel,onCreate:this.handleCreate}),_.default.createElement(b.Route,{path:"/chat/:id?",render:function(e){var t=e.match.params;return t.id?_.default.createElement(b.Redirect,{to:{pathname:"/chat",invite:{id:t.id}}}):_.default.createElement(r,(0,m.default)({},e,a.props,a.state,{createRoom:a.createRoom,deleteRoom:a.deleteRoom,changeRoom:a.changeRoom,sendMessage:a.sendMessage,getMessages:a.getMessages,changeRoomListProcessed:a.changeRoomListProcessed,handlerInvite:a.handlerInvite,addInviteToChecked:a.addInviteToChecked,setTypingIndicator:a.setTypingIndicator,clearTypingIndicator:a.clearTypingIndicator}))}})))}}]),l}(E.Component)}},973:function(){},976:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var u=n(a(123)),i=n(a(69)),s=n(a(21)),r=n(a(10)),l=n(a(3)),o=n(a(6)),c=n(a(4)),d=n(a(5)),f=n(a(194));a(134),a(71),a(94),a(206);var m=n(a(1)),p=f.default.Item,v=f.default.create()(function(e){function t(){return(0,l.default)(this,t),(0,c.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,d.default)(t,e),(0,o.default)(t,[{key:"render",value:function(){var e=this.props,t=e.invite,a=e.visible,n=e.handleCancel,r=e.onCreate,l=e.confirmLoading,o=e.form.getFieldDecorator;return m.default.createElement(u.default,{title:"Комната: "+t.room_name,visible:a,onOk:r,confirmLoading:l,onCancel:n,width:400},m.default.createElement(f.default,{layout:"vertical"},m.default.createElement(p,{label:"Пароль"},o("passwordRoom",{rules:[{required:!0,message:"Введите пароль для комнаты."}]})(m.default.createElement(i.default,{prefix:m.default.createElement(s.default,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"Пароль для комнаты"})))))}}]),t}(m.default.Component));t.default=v}},[[563,1,0]]]);